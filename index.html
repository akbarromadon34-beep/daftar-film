<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üé¨ Movie Index</title>
<style>
/* --- Styling tetap sama --- */
body {font-family:'Segoe UI',Arial,sans-serif;background-color:#16002b;color:#fff;margin:0;padding:0;}
header{background:linear-gradient(90deg,#6a0dad,#9b30ff);padding:15px 25px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 3px 10px rgba(0,0,0,0.3);flex-wrap:wrap;}
header h1{margin:0;font-size:1.8em;letter-spacing:0.5px;}
.controls{display:flex;gap:10px;align-items:center;}
#search,#folderSelect{padding:8px 12px;border:none;border-radius:8px;font-size:1em;outline:none;}
#folderSelect{background:#fff;color:#333;}
#progressBarContainer{position:fixed;top:0;left:0;width:100%;height:4px;background:rgba(255,255,255,0.1);z-index:999;}
#progressBar{height:4px;width:0%;background:#ff66ff;transition:width 0.3s;}
.container{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;padding:25px;}
.card{background:#250045;border-radius:12px;box-shadow:0 5px 10px rgba(0,0,0,0.3);overflow:hidden;display:flex;flex-direction:column;transition:transform 0.2s,box-shadow 0.2s;}
.card:hover{transform:scale(1.03);box-shadow:0 8px 18px rgba(0,0,0,0.5);}
.card img{width:100%;height:380px;object-fit:cover;background:#111;}
.card-content{padding:12px 15px;flex:1;display:flex;flex-direction:column;}
.card h3{font-size:1em;margin:8px 0 5px;}
.card p{margin:0;font-size:0.9em;color:#ccc;}
.download{margin-top:auto;text-align:center;}
.download a{display:inline-block;margin-top:10px;padding:8px 15px;background:#9b30ff;border-radius:6px;color:#fff;text-decoration:none;transition:background 0.2s;}
.download a:hover{background:#b84fff;}
.empty{text-align:center;padding:50px;color:#aaa;}
.card-wrapper{position:relative;}
@media(max-width:600px){header{flex-direction:column;align-items:flex-start;gap:10px;}.controls{flex-direction:column;width:100%;}#search,#folderSelect{width:100%;}}
</style>
</head>
<body>

<div id="progressBarContainer"><div id="progressBar"></div></div>

<header>
  <h1>üé¨ Movie Index</h1>
  <div class="controls">
    <select id="folderSelect">
      <option value="">All Categories</option>
      <option value="1FOLDER_ID_AMZN">Amazon</option>
      <option value="1FOLDER_ID_NF">Netflix</option>
    </select>
    <input type="text" id="search" placeholder="Search movies...">
  </div>
</header>

<div class="container" id="movies"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw03Ms12ikF2Ct9llJjgn2KhmXoLcvTYNAbW4F0Oe7W_iqvX-Sib8P6QbBF5mApCc4mFA/exec"; // <= proxy kamu
const OMDB_API_KEY = "10eca265";

// ==== Sharer.pw Config ====
const SHARER_EMAIL = "adwik2860@gmail.com";
const SHARER_KEY = "105662444125919720943";

const posterCache = {};

function setProgress(percent){document.getElementById("progressBar").style.width=percent+"%";}

// === Mirror ke Sharer.pw via Apps Script Proxy ===
async function mirrorToSharer(url){
  const cache = JSON.parse(localStorage.getItem("sharer_cache") || "{}");
  if (cache[url]) return cache[url];

  try{
    const body = new URLSearchParams();
    body.append("email", SHARER_EMAIL);
    body.append("api_key", SHARER_KEY);
    body.append("url", url);

    const res = await fetch(SCRIPT_URL, {
      method:"POST",
      headers:{"Content-Type":"application/x-www-form-urlencoded"},
      body
    });

    if(!res.ok){console.warn(`‚ö†Ô∏è Mirror gagal: HTTP ${res.status}`);return url;}

    const data = await res.json();
    if(data.status === "success" && data.url){
      cache[url] = data.url;
      localStorage.setItem("sharer_cache", JSON.stringify(cache));
      console.log("‚úÖ Mirror berhasil:", data.url);
      return data.url;
    } else {
      console.warn("‚ö†Ô∏è Mirror gagal:", data.message || JSON.stringify(data));
      return url;
    }
  }catch(err){
    console.error("‚ùå Koneksi Sharer.pw gagal:", err.message);
    return url;
  }
}

async function fetchMovies(url="https://script.google.com/macros/s/AKfycbxrKwd_61Ip4nuhNMJD_mzQw0FWfSmTmIU-1U7QBkcD7wfxZKojCzDfQUzxJu76Q-UMxw/exec"){
  setProgress(10);
  const res = await fetch(url);
  setProgress(40);
  const files = await res.json();
  setProgress(70);
  await renderMovies(files);
  setProgress(100);
  setTimeout(()=>setProgress(0),800);
}

async function getPoster(title){
  if(posterCache[title]) return posterCache[title];
  try{
    const omdbRes=await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=${OMDB_API_KEY}`);
    const omdbData=await omdbRes.json();
    if(omdbData.Poster && omdbData.Poster!=="N/A"){posterCache[title]=omdbData.Poster;return omdbData.Poster;}
  }catch{}
  posterCache[title]="https://via.placeholder.com/300x450?text=No+Image";
  return posterCache[title];
}

async function renderMovies(files){
  const container=document.getElementById("movies");
  container.innerHTML="";
  if(!files || files.length===0){
    container.innerHTML=`<div class="empty">No movies found</div>`;
    return;
  }
  for(const file of files){
    const displayName=file.name.replace(/\.[^/.]+$/,"");
    const poster=await getPoster(displayName);
    const sharerLink=await mirrorToSharer(file.url);

    const card=document.createElement("div");
    card.className="card-wrapper";
    card.innerHTML=`
      <div class="card">
        <img src="${poster}" alt="${displayName}">
        <div class="card-content">
          <h3>${displayName}</h3>
          <p>${file.size} ‚Äî ${file.folderName}</p>
          <div class="download"><a href="${sharerLink}" target="_blank">‚¨áÔ∏è Download</a></div>
        </div>
      </div>`;
    container.appendChild(card);
  }
}

document.getElementById("search").addEventListener("input",e=>{
  const val=e.target.value.toLowerCase();
  document.querySelectorAll(".card").forEach(c=>c.style.display=c.textContent.toLowerCase().includes(val)?"":"none");
});

document.getElementById("folderSelect").addEventListener("change",async e=>{
  const id=e.target.value;
  const url=id?`${SCRIPT_URL}?folderId=${id}`:SCRIPT_URL;
  await fetchMovies(url);
});

fetchMovies();
</script>
</body>
</html>
